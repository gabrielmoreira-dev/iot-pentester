import nmap
from model.device import Device
from model.service import Service

class Nmap:

    @staticmethod
    def scan():
        nm = nmap.PortScanner()
        nm.scan('192.168.1.1/24', arguments='-sS -O')

        deviceList = []
        for host in nm.all_hosts():
            os = ''
            vendor = ''
            
            for osmatch in nm[host]['osmatch']:
                for osclass in osmatch['osclass']:
                    os = osclass['vendor']
            for vendor in nm[host]['vendor']:
                vendor = nm[host]['vendor'][vendor]
            if os == '':
                os = 'SO desconhecido'
            if vendor == '':
                vendor = 'Fabricante desconhecido'
            hostname = os + ' - ' + vendor

            serviceList = []
            if 'tcp' in nm[host]:
                for port in nm[host]['tcp']:
                    serviceList.append(Service(
                        port,
                        'TCP',
                        nm[host]['tcp'][port]['name']
                    ))

            deviceList.append(Device(hostname, serviceList))

        return deviceList
        
            
